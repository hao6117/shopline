<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>南九州五日遊</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-dark: #121212;
            --bg-card: #1e1e1e;
            --accent: #d4af37; /* 金色 */
            --accent-light: #f1c40f;
            --text-main: #ffffff;
            --text-sub: #a0a0a0;
        }
        
        body {
            font-family: 'Noto Sans TC', sans-serif;
            background-color: black;
            color: var(--text-main);
            overflow-x: hidden;
            -webkit-tap-highlight-color: transparent;
        }

        /* 隱藏 Scrollbar 但保留功能 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        /* 玻璃擬態 */
        .glass-panel {
            background: rgba(30, 30, 30, 0.7);
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.08);
        }

        /* 左側導航激活狀態 */
        .nav-item.active {
            color: var(--accent);
            position: relative;
        }
        .nav-item.active::after {
            content: '';
            position: absolute;
            left: -12px;
            top: 50%;
            transform: translateY(-50%);
            width: 4px;
            height: 20px;
            background-color: var(--accent);
            border-radius: 0 4px 4px 0;
        }

        /* 頂部導航激活狀態 (原底部導航) */
        .tab-btn {
            position: relative;
        }
        .tab-btn.active {
            color: var(--accent);
        }
        .tab-btn.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 50%;
            transform: translateX(-50%);
            width: 40%;
            height: 3px;
            background-color: var(--accent);
            border-radius: 3px 3px 0 0;
        }

        /* 小撇步區塊樣式 */
        .tip-box {
            background: rgba(212, 175, 55, 0.1);
            border-left: 4px solid var(--accent);
        }

        /* 詳細資訊文字樣式 */
        .spot-detail {
            font-size: 0.75rem;
            color: #ccc;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            line-height: 1.5;
        }
        .spot-tag {
            color: #d4af37;
            font-weight: bold;
            margin-right: 4px;
        }
        
        /* 檔案上傳樣式優化 */
        .custom-file-input::-webkit-file-upload-button {
            cursor: pointer;
        }
        
        /* Calculator Button Style */
        .calc-btn {
            padding: 10px 0;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1rem;
            background-color: #333;
            color: var(--text-main);
            transition: background-color 0.15s, transform 0.1s;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.5);
            -webkit-tap-highlight-color: transparent; /* 移除點擊高亮 */
        }
        .calc-btn:active {
            transform: scale(0.95);
        }
    </style>
</head>
<body class="h-screen flex flex-col max-w-md mx-auto relative shadow-2xl shadow-gray-900 border-x border-gray-800">

    <div class="h-12 flex-none flex items-center justify-between px-5 bg-[#121212] border-b border-gray-800 z-50">
        <span class="text-sm font-bold text-gray-400">南九州之旅</span>
        <div class="flex items-center space-x-2">
            <span class="text-xs px-2 py-1 bg-gray-800 rounded-full text-gray-400">5 Days</span>
        </div>
    </div>

    <nav class="h-14 flex-none bg-[#181818] border-b border-gray-800 flex justify-around items-center px-2 z-40">
        <button onclick="switchMainTab('itinerary', this)" class="tab-btn active flex-1 flex items-center justify-center text-gray-500 h-full space-x-2">
            <i class="fas fa-calendar-alt text-lg"></i>
            <span class="text-sm font-bold">行程</span>
        </button>
        <button onclick="switchMainTab('tools', this)" class="tab-btn flex-1 flex items-center justify-center text-gray-500 h-full space-x-2">
            <i class="fas fa-wallet text-lg"></i>
            <span class="text-sm font-bold">錢包與工具</span>
        </button>
    </nav>

    <main class="flex-1 overflow-hidden relative bg-[#121212]">
        
        <div id="itinerary-view" class="section-view w-full h-full flex">
            
            <div class="w-20 bg-[#181818] h-full flex flex-col items-center py-4 space-y-8 overflow-y-auto no-scrollbar border-r border-gray-800 z-10">
                <div onclick="scrollToDay('day1')" class="nav-item active flex flex-col items-center cursor-pointer transition-colors duration-300 text-gray-500 hover:text-gray-300">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center mb-1 shadow-lg">
                        <i class="fas fa-plane text-sm"></i>
                    </div>
                    <span class="text-[10px] font-bold">Day 1</span>
                    <span class="text-[9px]">12/4</span>
                </div>

                <div onclick="scrollToDay('day2')" class="nav-item flex flex-col items-center cursor-pointer transition-colors duration-300 text-gray-500 hover:text-gray-300">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center mb-1 shadow-lg">
                        <i class="fas fa-mountain text-sm"></i>
                    </div>
                    <span class="text-[10px] font-bold">Day 2</span>
                    <span class="text-[9px]">12/5</span>
                </div>

                <div onclick="scrollToDay('day3')" class="nav-item flex flex-col items-center cursor-pointer transition-colors duration-300 text-gray-500 hover:text-gray-300">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center mb-1 shadow-lg">
                        <i class="fas fa-water text-sm"></i>
                    </div>
                    <span class="text-[10px] font-bold">Day 3</span>
                    <span class="text-[9px]">12/6</span>
                </div>

                <div onclick="scrollToDay('day4')" class="nav-item flex flex-col items-center cursor-pointer transition-colors duration-300 text-gray-500 hover:text-gray-300">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center mb-1 shadow-lg">
                        <i class="fas fa-torii-gate text-sm"></i>
                    </div>
                    <span class="text-[10px] font-bold">Day 4</span>
                    <span class="text-[9px]">12/7</span>
                </div>

                <div onclick="scrollToDay('day5')" class="nav-item flex flex-col items-center cursor-pointer transition-colors duration-300 text-gray-500 hover:text-gray-300">
                    <div class="w-10 h-10 rounded-full bg-gray-800 flex items-center justify-center mb-1 shadow-lg">
                        <i class="fas fa-suitcase text-sm"></i>
                    </div>
                    <span class="text-[10px] font-bold">Day 5</span>
                    <span class="text-[9px]">12/8</span>
                </div>
            </div>

            <div id="content-scroll" class="flex-1 h-full overflow-y-auto bg-black p-4 space-y-16 pb-8 scroll-smooth">
                
                <div id="day1" class="day-section pt-2">
                    <span class="inline-block px-3 py-1 bg-[#d4af37] text-black text-xs font-bold rounded mb-2">Day 1 • 12/4 (四)</span>
                    <h2 class="text-3xl font-bold mb-4 text-white">鹿兒島・抵達</h2>
                    
                    <div class="bg-blue-900/20 border border-blue-800 rounded-lg p-3 mb-6">
                        <h4 class="text-blue-400 text-xs font-bold mb-2"><i class="fas fa-temperature-low mr-1"></i> 12月天氣與穿搭</h4>
                        <p class="text-gray-300 text-xs leading-5">
                            <span class="text-white">氣溫：</span> 平均 5°C ~ 15°C，早晚溫差大。<br>
                            <span class="text-white">建議：</span> 洋蔥式穿搭。發熱衣、毛衣、防風外套(羽絨)是必備。建議攜帶圍巾與折疊傘(偶有雨)。
                        </p>
                    </div>

                    <p class="text-gray-400 text-sm mb-6 leading-relaxed">
                        抵達鹿兒島，感受南九州的熱情。首站前往武家屋敷體驗歷史，晚上在天文館商店街享受美食與購物。
                    </p>

                    <div class="space-y-3">
                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-blue-900/30 flex items-center justify-center mr-3 text-blue-400"><i class="fas fa-plane-arrival"></i></div>
                                    <div class="font-bold text-sm">鹿兒島空港</div>
                                </div>
                                <button onclick="openMap('鹿兒島空港')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>機場外有天然溫泉足湯「おやっとさぁ」可免費體驗。抵達後可先去買個薩摩炸魚餅解饞。
                            </div>
                             <div id="note-day1-0" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day1', 0)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day1-0" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day1', 0)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day1-0"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-orange-900/30 flex items-center justify-center mr-3 text-orange-400"><i class="fas fa-landmark"></i></div>
                                    <div class="font-bold text-sm">知覽武家屋敷</div>
                                </div>
                                <button onclick="openMap('知覽武家屋敷')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>高城庵 (鄉土料理)，必吃雞肉刺身。下午茶推薦「川口茶舖」的傳統甜點或「知覽農園」的抹茶霜淇淋。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>被稱為「薩摩的小京都」，七個庭園各有特色，建議預留 1.5 小時散步。</div>
                            </div>
                             <div id="note-day1-1" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day1', 1)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day1-1" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day1', 1)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day1-1"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-pink-900/30 flex items-center justify-center mr-3 text-pink-400"><i class="fas fa-shopping-bag"></i></div>
                                    <div class="font-bold text-sm">天文館商店街</div>
                                </div>
                                <button onclick="openMap('天文館商店街')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>「鰻魚末吉」炭烤鰻魚飯、「天文館無邪氣」白熊冰、「蜂樂饅頭」。晚餐推薦「吾愛人」黑豚涮涮鍋。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>藥妝店激戰區。唐吉訶德和Sun Drug都在這，建議先比價再下手。</div>
                            </div>
                             <div id="note-day1-2" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day1', 2)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day1-2" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day1', 2)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day1-2"></div>
                            </div>
                        </div>
                    </div>

                    <div class="mt-6 p-4 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 flex items-center justify-between">
                        <div>
                            <div class="text-[10px] text-[#d4af37] font-bold uppercase tracking-wider mb-1">Accommodation</div>
                            <div class="font-bold text-sm">城山ホテル鹿児島</div>
                        </div>
                        <button onclick="openMap('城山ホテル鹿児島')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform p-1">
                            <i class="fas fa-bed text-lg"></i>
                        </button>
                    </div>
                </div>

                <div id="day2" class="day-section">
                    <span class="inline-block px-3 py-1 bg-gray-700 text-gray-300 text-xs font-bold rounded mb-2">Day 2 • 12/5 (五)</span>
                    <h2 class="text-3xl font-bold mb-4 text-white">櫻島・霧島</h2>
                    <p class="text-gray-400 text-sm mb-6">搭乘渡輪前往活火山櫻島，感受大自然的震撼，隨後前往霧島參拜神宮。</p>

                    <div class="space-y-3">
                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-green-900/30 flex items-center justify-center mr-3 text-green-400"><i class="fas fa-binoculars"></i></div>
                                    <div class="font-bold text-sm">城山公園展望台</div>
                                </div>
                                <button onclick="openMap('城山公園展望台')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>拍攝櫻島火山的最佳位置。步道完善，早晨空氣好，適合散步看日出。
                            </div>
                             <div id="note-day2-0" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day2', 0)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day2-0" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day2', 0)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day2-0"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-pink-900/30 flex items-center justify-center mr-3 text-pink-400"><i class="fas fa-fan"></i></div>
                                    <div class="font-bold text-sm">仙巖園</div>
                                </div>
                                <button onclick="openMap('仙巖園')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>必吃「兩棒餅」(Jambo Mochi)，有味噌和醬油口味。推薦去「仙巖園茶寮」享用。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>旁邊的星巴克是「舊島津家礦山事務所」改建的登錄有形文化財，非常漂亮，值得入內喝一杯。</div>
                            </div>
                             <div id="note-day2-1" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day2', 1)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day2-1" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day2', 1)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day2-1"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-blue-900/30 flex items-center justify-center mr-3 text-blue-400"><i class="fas fa-ship"></i></div>
                                    <div class="font-bold text-sm">櫻島渡輪</div>
                                </div>
                                <button onclick="openMap('櫻島渡輪')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>船內的「藪金烏龍麵」非常有名，航程僅15分鐘，上船後要"手刀"去點餐趕快吃！</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-wind"></i> 天氣：</span>海風大且可能會有火山灰，建議戴口罩和帽子保護。</div>
                            </div>
                             <div id="note-day2-2" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day2', 2)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day2-2" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day2', 2)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day2-2"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-red-900/30 flex items-center justify-center mr-3 text-red-400"><i class="fas fa-torii-gate"></i></div>
                                    <div class="font-bold text-sm">霧島神宮</div>
                                </div>
                                <button onclick="openMap('霧島神宮')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>周邊有「黑豚料理」或霧島溫泉市場的「溫泉蛋」。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>坂本龍馬蜜月之地，求姻緣與事業運很靈。別忘了找找這裡的能量景點「龜石」和「御神木」。</div>
                            </div>
                             <div id="note-day2-3" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day2', 3)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day2-3" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day2', 3)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day2-3"></div>
                            </div>
                        </div>
                    </div>
                     <div class="mt-6 p-4 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 flex items-center justify-between">
                        <div>
                            <div class="text-[10px] text-[#d4af37] font-bold uppercase tracking-wider mb-1">Accommodation</div>
                            <div class="font-bold text-sm">霧島国際ホテル</div>
                        </div>
                        <button onclick="openMap('霧島国際ホテル')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform p-1">
                            <i class="fas fa-bed text-lg"></i>
                        </button>
                    </div>
                </div>

                <div id="day3" class="day-section">
                    <span class="inline-block px-3 py-1 bg-gray-700 text-gray-300 text-xs font-bold rounded mb-2">Day 3 • 12/6 (六)</span>
                    <h2 class="text-3xl font-bold mb-4 text-white">宮崎・日南</h2>
                    
                    <div class="space-y-3">
                         <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-blue-900/30 flex items-center justify-center mr-3 text-blue-400"><i class="fas fa-water"></i></div>
                                    <div class="font-bold text-sm">關之尾瀑布</div>
                                </div>
                                <button onclick="openMap('關之尾瀑布')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>重點是世界最大規模的「甌穴群」(Pot Holes)。步道較濕滑請小心。
                            </div>
                             <div id="note-day3-0" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day3', 0)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day3-0" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day3', 0)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day3-0"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center mr-3 text-gray-300"><i class="fas fa-archway"></i></div>
                                    <div class="font-bold text-sm">日南太陽花園 (摩艾)</div>
                                </div>
                                <button onclick="openMap('日南太陽花園')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>園區餐廳可嘗試宮崎特產「南蠻雞」。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>7尊摩艾像各代表不同運勢(左起：工作、健康、戀愛、全體(夢想)、結婚、金運、學業)，記得去抱抱你需要的那一尊！</div>
                            </div>
                             <div id="note-day3-1" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day3', 1)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day3-1" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day3', 1)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day3-1"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-red-900/30 flex items-center justify-center mr-3 text-red-400"><i class="fas fa-rabbit"></i></div>
                                    <div class="font-bold text-sm">鵜戶神宮</div>
                                </div>
                                <button onclick="openMap('鵜戶神宮')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>參道商店有賣「泡芙」和特色「運玉饅頭」。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>一定要買「運玉」(5顆)，規則是【男左手、女右手】，投進龜岩背上的繩圈內許願，願望就會成真！</div>
                            </div>
                             <div id="note-day3-2" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day3', 2)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day3-2" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day3', 2)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day3-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 p-4 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 flex items-center justify-between">
                        <div>
                            <div class="text-[10px] text-[#d4af37] font-bold uppercase tracking-wider mb-1">Accommodation</div>
                            <div class="font-bold text-sm">宮崎觀光飯店</div>
                        </div>
                        <button onclick="openMap('宮崎觀光飯店')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform p-1">
                            <i class="fas fa-bed text-lg"></i>
                        </button>
                    </div>
                </div>

                <div id="day4" class="day-section">
                    <span class="inline-block px-3 py-1 bg-gray-700 text-gray-300 text-xs font-bold rounded mb-2">Day 4 • 12/7 (日)</span>
                    <h2 class="text-3xl font-bold mb-4 text-white">神話・高千穗</h2>
                    <div class="space-y-3">
                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-700 flex items-center justify-center mr-3 text-gray-300"><i class="fas fa-history"></i></div>
                                    <div class="font-bold text-sm">飫肥城跡</div>
                                </div>
                                <button onclick="openMap('飫肥城跡')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>記得購買「邊走邊吃地圖(あゆみちゃんマップ)」，可兌換「厚燒玉子」(口感像布丁)與「飫肥天」(炸魚餅)等5種美食/門票，非常划算。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>商家資料館或舊山本豬平家都可使用地圖兌換券入內參觀。</div>
                            </div>
                             <div id="note-day4-0" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day4', 0)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day4-0" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day4', 0)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day4-0"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-yellow-900/30 flex items-center justify-center mr-3 text-yellow-400"><i class="fas fa-train"></i></div>
                                    <div class="font-bold text-sm">高千穗天照鐵道</div>
                                </div>
                                <button onclick="openMap('高千穗天照鐵道')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-wind"></i> 天氣/穿著：</span>小火車為開放式車廂，經過高達105公尺的高鐵橋時風大且冷，景色壯觀，務必戴帽子與穿防風外套。
                            </div>
                             <div id="note-day4-1" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day4', 1)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day4-1" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day4', 1)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day4-1"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-green-900/30 flex items-center justify-center mr-3 text-green-400"><i class="fas fa-water"></i></div>
                                    <div class="font-bold text-sm">高千穗峽</div>
                                </div>
                                <button onclick="openMap('高千穗峽')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>「千穗之家」是流水麵發源地，體驗用竹管運送的素麵，好吃又好玩。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>划船非常熱門，建議一早就先去預約或線上預訂，等待時間可先去吃流水麵。</div>
                            </div>
                             <div id="note-day4-2" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day4', 2)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day4-2" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day4', 2)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day4-2"></div>
                            </div>
                        </div>
                    </div>
                    <div class="mt-6 p-4 rounded-xl bg-gradient-to-r from-gray-800 to-gray-900 border border-gray-700 flex items-center justify-between">
                        <div>
                            <div class="text-[10px] text-[#d4af37] font-bold uppercase tracking-wider mb-1">Accommodation</div>
                            <div class="font-bold text-sm">ANA Crowne Plaza Kumamoto</div>
                        </div>
                        <button onclick="openMap('ANA Crowne Plaza Kumamoto')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform p-1">
                            <i class="fas fa-bed text-lg"></i>
                        </button>
                    </div>
                </div>

                <div id="day5" class="day-section">
                    <span class="inline-block px-3 py-1 bg-gray-700 text-gray-300 text-xs font-bold rounded mb-2">Day 5 • 12/8 (一)</span>
                    <h2 class="text-3xl font-bold mb-4 text-white">熊本・返程</h2>
                    <div class="space-y-3">
                         <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-gray-800 flex items-center justify-center mr-3 text-white"><i class="fas fa-chess-rook"></i></div>
                                    <div class="font-bold text-sm">熊本城</div>
                                </div>
                                <button onclick="openMap('熊本城')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <div><span class="spot-tag"><i class="fas fa-utensils"></i> 美食：</span>旁邊的「櫻之馬場 城彩苑」是美食聚集地。必吃：海膽可樂餅(Uni Coloquette)、辛子蓮藕、いきなり団子(Ikinari Dango)。</div>
                                <div class="mt-1"><span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>天守閣頂樓景色優美。</div>
                            </div>
                             <div id="note-day5-0" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day5', 0)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day5-0" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day5', 0)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day5-0"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-pink-900/30 flex items-center justify-center mr-3 text-pink-400"><i class="fas fa-shopping-bag"></i></div>
                                    <div class="font-bold text-sm">櫻町購物中心</div>
                                </div>
                                <button onclick="openMap('SAKURA MACHI Kumamoto')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                            <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>頂樓花園有超巨大熊本熊雕像，是打卡熱點。B1超市可買最後伴手禮。
                            </div>
                             <div id="note-day5-1" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day5', 1)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day5-1" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day5', 1)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day5-1"></div>
                            </div>
                        </div>

                        <div class="glass-panel p-3 rounded-xl transition-transform">
                            <div class="flex items-center justify-between mb-1">
                                <div class="flex items-center">
                                    <div class="w-8 h-8 rounded-full bg-blue-900/30 flex items-center justify-center mr-3 text-blue-400"><i class="fas fa-plane-departure"></i></div>
                                    <div class="font-bold text-sm">熊本空港 -> 桃園</div>
                                </div>
                                <button onclick="openMap('熊本機場')" class="text-gray-500 hover:text-[#d4af37] transition-colors active:scale-90 transform flex-shrink-0 p-1">
                                    <i class="fas fa-map-marker-alt text-lg"></i>
                                </button>
                            </div>
                             <div class="spot-detail">
                                <span class="spot-tag"><i class="fas fa-info-circle"></i> 建議：</span>新航廈管制區內美食超強！必吃「菅乃屋」馬肉、「壽司福伸」天草鮪魚或「味千x桂花」聯名拉麵。
                            </div>
                             <div id="note-day5-2" class="mt-4 pt-3 border-t border-gray-700/50">
                                <h5 class="text-xs text-gray-400 font-bold mb-2 flex items-center"><i class="fas fa-pen mr-1"></i> 備註 (可上傳照片)</h5>
                                <textarea oninput="saveSpotNote('day5', 2)" class="w-full h-16 bg-gray-800/50 border border-gray-700 rounded-lg p-2 text-xs text-white resize-none outline-none focus:border-[#d4af37] mb-2" placeholder="輸入我的個人備註..."></textarea>
                                <input type="file" id="image-day5-2" accept="image/*" class="custom-file-input w-full text-xs text-gray-500 file:mr-2 file:py-1 file:px-3 file:rounded-full file:border-0 file:text-xs file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600" onchange="addSpotImage('day5', 2)">
                                <div class="mt-2 flex flex-wrap gap-2" id="images-day5-2"></div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
        </div>

        <div id="tools-view" class="section-view hidden w-full h-full p-5 overflow-y-auto pb-8">
            <h2 class="text-2xl font-bold mb-6 text-white">旅行助手</h2>
            
            <div class="bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-2xl shadow-lg border border-gray-700 mb-6 relative overflow-hidden">
                <div class="absolute -right-4 -top-4 w-24 h-24 bg-[#d4af37] opacity-10 rounded-full blur-2xl"></div>
                <div class="text-gray-400 text-xs mb-1">目前總支出 (TWD)</div>
                <div class="text-3xl font-bold text-white mb-2" id="totalTWD">NT$ 0</div>
                <div class="text-xs text-gray-500">約合日幣: ¥<span id="totalJPY">0</span></div>
            </div>

            <div class="mb-8">
                <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">匯率換算</h3>
                <div class="glass-panel p-4 rounded-xl space-y-3">
                    <div class="flex items-center justify-between text-sm">
                        <span class="text-gray-400">目前匯率</span>
                        <input type="number" id="rate" value="0.215" step="0.001" class="bg-transparent text-right text-white font-mono outline-none w-20 border-b border-gray-700 focus:border-[#d4af37]" oninput="convertCurrency()">
                    </div>
                    
                    <div class="flex items-center gap-3">
                        <div class="flex-1 bg-gray-800 rounded-lg p-2 flex items-center">
                            <span class="text-xs text-gray-500 mr-2">¥</span>
                            <input type="text" id="calcJpy" placeholder="日幣或運算式" class="w-full bg-transparent outline-none text-white text-right" oninput="convertCurrency()">
                        </div>
                        <i class="fas fa-arrow-right text-gray-600 text-xs"></i>
                        <div class="flex-1 bg-gray-800/50 rounded-lg p-2 flex items-center justify-end">
                            <span class="text-xs text-gray-500 mr-2">$</span>
                            <span id="calcTwd" class="text-[#d4af37] font-bold">0</span>
                        </div>
                    </div>

                    <div class="grid grid-cols-4 gap-2 pt-2">
                        <button onclick="clearCalc()" class="calc-btn bg-gray-700 text-white col-span-2">C</button>
                        <button onclick="appendToCalc('/')" class="calc-btn bg-gray-700 text-white">/</button>
                        <button onclick="appendToCalc('*')" class="calc-btn bg-gray-700 text-white">x</button>
                        <button onclick="appendToCalc('7')" class="calc-btn">7</button>
                        <button onclick="appendToCalc('8')" class="calc-btn">8</button>
                        <button onclick="appendToCalc('9')" class="calc-btn">9</button>
                        <button onclick="appendToCalc('-')" class="calc-btn bg-gray-700 text-white">-</button>
                        <button onclick="appendToCalc('4')" class="calc-btn">4</button>
                        <button onclick="appendToCalc('5')" class="calc-btn">5</button>
                        <button onclick="appendToCalc('6')" class="calc-btn">6</button>
                        <button onclick="appendToCalc('+')" class="calc-btn bg-gray-700 text-white">+</button>
                        <button onclick="appendToCalc('1')" class="calc-btn">1</button>
                        <button onclick="appendToCalc('2')" class="calc-btn">2</button>
                        <button onclick="appendToCalc('3')" class="calc-btn">3</button>
                        <button onclick="calculateResult()" class="calc-btn bg-[#d4af37] text-black row-span-2">=</button>
                        <button onclick="appendToCalc('0')" class="calc-btn col-span-2">0</button>
                        <button onclick="appendToCalc('.')" class="calc-btn">.</button>
                    </div>

                </div>
            </div>

            <div class="mb-8">
                <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">新增消費</h3>
                <div class="flex flex-col gap-3 mb-3"> <!-- 改為 flex-col 並增加 gap -->
                    <input type="text" id="descInput" placeholder="項目 (如: 拉麵)" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-sm text-white outline-none focus:border-[#d4af37]"> <!-- 改為 w-full -->
                    <input type="number" id="amtInput" placeholder="¥ 金額" class="w-full bg-gray-800 border border-gray-700 rounded-lg p-3 text-sm text-white outline-none focus:border-[#d4af37]"> <!-- 改為 w-full -->
                </div>
                <div class="mb-3">
                    <label for="expenseImageInput" class="block text-xs font-medium text-gray-400 mb-1">上傳照片 (選填，最大 500KB)</label>
                    <input type="file" id="expenseImageInput" accept="image/*" class="w-full text-sm text-gray-500 custom-file-input file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-gray-700 file:text-white hover:file:bg-gray-600">
                </div>
                <button onclick="addExpense()" class="w-full bg-[#d4af37] hover:bg-[#b5952f] text-black font-bold py-3 rounded-lg transition-colors active:scale-95 transform">
                    <i class="fas fa-plus mr-1"></i> 記一筆
                </button>
            </div>

            <div>
                <div class="flex justify-between items-end mb-3">
                    <h3 class="text-sm font-bold text-gray-400 uppercase tracking-wider">消費明細</h3>
                    <button onclick="clearExpenses()" class="text-xs text-red-500 hover:text-red-400">清除全部</button>
                </div>
                <div id="expenseList" class="space-y-2">
                    </div>
            </div>

            <div class="mt-8 pt-8 border-t border-gray-800">
                <h3 class="text-sm font-bold text-gray-400 mb-3 uppercase tracking-wider">天氣預報</h3>
                <div class="grid grid-cols-3 gap-2">
                    <a href="https://tenki.jp/forecast/9/46/8810/" target="_blank" class="bg-blue-900/20 border border-blue-900/50 text-blue-400 text-center py-3 rounded-lg text-xs hover:bg-blue-900/30">鹿兒島</a>
                    <a href="https://tenki.jp/forecast/9/45/8710/" target="_blank" class="bg-blue-900/20 border border-blue-900/50 text-blue-400 text-center py-3 rounded-lg text-xs hover:bg-blue-900/30">宮崎</a>
                    <a href="https://tenki.jp/forecast/9/43/8610/" target="_blank" class="bg-blue-900/20 border border-blue-900/50 text-blue-400 text-center py-3 rounded-lg text-xs hover:bg-blue-900/30">熊本</a>
                </div>
            </div>
        </div>

    </main>
    
    <div id="customAlertModal" class="hidden fixed bottom-4 left-1/2 transform -translate-x-1/2 z-50 transition-opacity duration-300">
        <div class="bg-red-600 text-white px-4 py-2 rounded-lg shadow-2xl flex items-center space-x-2">
            <i class="fas fa-exclamation-triangle"></i>
            <span id="customAlertMessage" class="text-sm font-medium"></span>
        </div>
    </div>

    <div id="imageModal" class="hidden fixed inset-0 bg-black/90 flex items-center justify-center p-4 z-50" onclick="document.getElementById('imageModal').classList.add('hidden');">
        <img id="modalImage" src="" alt="Expense Receipt" class="max-w-full max-h-full rounded-lg shadow-xl" onclick="event.stopPropagation();">
        <button class="absolute top-4 right-4 text-white text-3xl opacity-80 hover:opacity-100 transition-opacity p-2" onclick="document.getElementById('imageModal').classList.add('hidden');">
            <i class="fas fa-times-circle"></i>
        </button>
        <button id="deleteSpotImageBtn" class="hidden absolute bottom-4 right-4 bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded-full text-xs font-bold transition-colors" onclick="deleteSpotImage(event)">
            <i class="fas fa-trash-alt mr-1"></i> 刪除照片
        </button>
    </div>

<script>
    // --- 0. 輔助函式 ---
    
    // 替代 alert() 的自定義提示框
    function showCustomAlert(message) {
        const alertModal = document.getElementById('customAlertModal');
        document.getElementById('customAlertMessage').innerText = message;
        alertModal.classList.remove('hidden');
        setTimeout(() => {
            alertModal.classList.add('hidden');
        }, 3000); // 3 秒後消失
    }

    // 將 File 物件轉換為 Base64 字串
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
            reader.readAsDataURL(file);
        });
    }

    // 顯示全螢幕圖片
    let currentSpotImage = null; // 紀錄目前開啟的景點圖片資訊
    function showFullImage(base64Data, dayId = null, spotIndex = null, imgIndex = null) {
        document.getElementById('modalImage').src = base64Data;
        document.getElementById('imageModal').classList.remove('hidden');
        
        // 如果是景點備註圖片，顯示刪除按鈕
        const deleteBtn = document.getElementById('deleteSpotImageBtn');
        if (dayId !== null && spotIndex !== null && imgIndex !== null) {
            currentSpotImage = { dayId, spotIndex, imgIndex };
            deleteBtn.classList.remove('hidden');
        } else {
            currentSpotImage = null;
            deleteBtn.classList.add('hidden');
        }
    }

    // 景點圖片刪除邏輯
    function deleteSpotImage(event) {
        event.stopPropagation(); // 防止點擊刪除按鈕關閉 Modal
        if (!currentSpotImage) return;

        const { dayId, spotIndex, imgIndex } = currentSpotImage;
        if (window.confirm('確定刪除這張備註照片嗎？')) {
            spotNotes[dayId][spotIndex].images.splice(imgIndex, 1);
            localStorage.setItem('spotNotes', JSON.stringify(spotNotes));
            
            // 重新渲染該景點的圖片並關閉 Modal
            renderSpotImages(dayId, spotIndex);
            document.getElementById('imageModal').classList.add('hidden');
            currentSpotImage = null;
        }
    }

    // --- 1. 導航邏輯 (不變) ---
    function switchMainTab(tabName, btn) {
        // 切換內容區
        document.querySelectorAll('.section-view').forEach(el => el.classList.add('hidden'));
        document.getElementById(tabName + '-view').classList.remove('hidden');
        
        // 切換按鈕狀態
        document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
    }

    // 左側 Timeline 點擊滾動
    function scrollToDay(dayId) {
        const element = document.getElementById(dayId);
        const container = document.getElementById('content-scroll');
        if (element && container) {
            container.scrollTo({
                top: element.offsetTop - 20, // 稍微留點上邊距
                behavior: 'smooth'
            });
        }
    }

    // 監聽滾動以更新左側激活狀態
    document.getElementById('content-scroll').addEventListener('scroll', function() {
        const container = this;
        const days = ['day1', 'day2', 'day3', 'day4', 'day5'];
        let currentDay = '';

        days.forEach(dayId => {
            const el = document.getElementById(dayId);
            if (el.offsetTop <= container.scrollTop + 150) {
                currentDay = dayId;
            }
        });

        if (currentDay) {
            document.querySelectorAll('.nav-item').forEach(nav => nav.classList.remove('active'));
            // 找到對應的 nav-item 並加上 active
            const index = days.indexOf(currentDay);
            if (index !== -1) {
                document.querySelectorAll('.nav-item')[index].classList.add('active');
            }
        }
    });

    // --- 2. 外部連結邏輯 (不變) ---
    function openMap(locationName) {
        const query = encodeURIComponent(locationName);
        window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
    }

    // --- 3. 記帳與匯率邏輯 (與原版相同) ---
    let expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];
    let currentRate = 0.215;

    function renderExpenses() {
        const list = document.getElementById('expenseList');
        const totalTwdEl = document.getElementById('totalTWD');
        const totalJpyEl = document.getElementById('totalJPY');
        
        list.innerHTML = '';
        let totalJpy = 0;

        expenses.slice().reverse().forEach((item, index) => {
            totalJpy += parseFloat(item.amount);
            const twdVal = Math.round(item.amount * currentRate);
            
            const div = document.createElement('div');
            // 由於 slice().reverse() 的 index 是依據反轉陣列，所以刪除時要計算正確的原始 index
            const originalIndex = expenses.length - 1 - index; 

            div.className = 'glass-panel p-3 rounded-lg flex justify-between items-center';
            div.innerHTML = `
                <div class="flex items-start">
                    ${item.image ? `
                        <img src="${item.image}" alt="${item.desc} Receipt" 
                             class="w-12 h-12 object-cover rounded-md mr-3 flex-shrink-0 cursor-pointer transition-transform active:scale-95" 
                             onclick="showFullImage('${item.image}')">
                    ` : ''}
                    <div>
                        <div class="font-bold text-sm text-white">${item.desc}</div>
                        <div class="text-xs text-gray-500">NT$ ${twdVal}</div>
                    </div>
                </div>
                <div class="flex items-center">
                    <span class="font-mono font-bold text-[#d4af37] mr-3">¥${item.amount}</span>
                    <button class="text-gray-600 hover:text-red-500 transition-colors w-6 h-6 flex items-center justify-center rounded-full" onclick="deleteExpense(${originalIndex})">
                        <i class="fas fa-times text-xs"></i>
                    </button>
                </div>
            `;
            list.appendChild(div);
        });

        totalJpyEl.innerText = totalJpy;
        totalTwdEl.innerText = 'NT$ ' + Math.round(totalJpy * currentRate).toLocaleString();
    }

    // 處理日幣換算邏輯 (現可接受運算式)
    function convertCurrency() {
        const rate = parseFloat(document.getElementById('rate').value);
        const jpyExpression = document.getElementById('calcJpy').value.replace(/x/g, '*').trim(); // 替換 'x' 為 '*'
        currentRate = rate;
        
        let jpyAmount = 0;

        try {
            // 嘗試計算表達式
            if (jpyExpression) {
                // 使用 Function 構造函數執行運算式，比 eval() 略安全
                jpyAmount = Function('return ' + jpyExpression)(); 
                // 只保留兩位小數
                jpyAmount = parseFloat(jpyAmount.toFixed(2));
            }
        } catch(e) {
            // 如果不是有效的數學表達式，則將其視為 0 或不處理
            jpyAmount = 0;
        }

        if(!isNaN(jpyAmount) && jpyAmount > 0) {
            document.getElementById('calcTwd').innerText = Math.round(jpyAmount * rate).toLocaleString();
        } else {
            document.getElementById('calcTwd').innerText = '0';
        }
        
        // 匯率變動時重算總支出
        renderExpenses(); 
    }
    
    // 計算機邏輯 - 附加值到輸入框
    function appendToCalc(value) {
        const input = document.getElementById('calcJpy');
        if (value === 'C') {
            // Clear all
            clearCalc();
            return;
        }
        
        // 替換 'x' 為 '*'
        const cleanValue = value === '*' ? 'x' : value; 

        // 避免連續輸入運算符
        const lastChar = input.value.slice(-1);
        const isOperator = (char) => ['+', '-', 'x', '/', '.'].includes(char);
        
        if (isOperator(lastChar) && isOperator(cleanValue)) {
            // 替換最後一個操作符 (例如: 10++ -> 10+)
            input.value = input.value.slice(0, -1) + cleanValue;
        } else {
            input.value += cleanValue;
        }

        convertCurrency(); // 每次輸入都自動換算
    }

    // 計算機邏輯 - 執行運算
    function calculateResult() {
        const input = document.getElementById('calcJpy');
        let expression = input.value.replace(/x/g, '*');

        try {
            if (expression) {
                // 執行計算
                let result = Function('return ' + expression)();
                
                // 限制小數點後兩位
                result = parseFloat(result.toFixed(2));

                input.value = result; // 將結果填回輸入框
                convertCurrency(); // 換算結果
            }
        } catch(e) {
            showCustomAlert('運算式錯誤');
            input.value = ''; // 清空輸入
            convertCurrency();
        }
    }

    // 計算機邏輯 - 清空
    function clearCalc() {
        document.getElementById('calcJpy').value = '';
        convertCurrency();
    }


    // 變為 async 函式以處理檔案讀取
    async function addExpense() {
        const desc = document.getElementById('descInput').value.trim();
        const amt = document.getElementById('amtInput').value.trim();
        const imageInput = document.getElementById('expenseImageInput'); // 更改 ID
        const imageFile = imageInput.files[0];
        let base64Image = null;

        if (!desc || !amt || isNaN(parseFloat(amt))) {
            showCustomAlert('請輸入有效的項目名稱和金額 (日幣)');
            return;
        }

        if (imageFile) {
            // 註：使用 localStorage 存 Base64 圖片只適用於小型資料，實際應用應使用 Firebase Storage 等雲端服務。
            const maxSize = 500 * 1024; // 500 KB 限制
            if (imageFile.size > maxSize) {
                showCustomAlert('圖片檔案過大 (限制 500KB)，請選擇較小的圖片。');
                imageInput.value = ''; // 清除檔案輸入
                return;
            }

            try {
                base64Image = await fileToBase64(imageFile);
            } catch(e) {
                showCustomAlert('讀取圖片失敗。');
                return;
            }
        }

        expenses.push({ 
            desc: desc, 
            amount: parseFloat(amt), 
            image: base64Image, // 儲存 Base64 字串
            timestamp: new Date().toISOString()
        });

        localStorage.setItem('tripExpenses', JSON.stringify(expenses));
        document.getElementById('descInput').value = '';
        document.getElementById('amtInput').value = '';
        imageInput.value = ''; // 清除檔案輸入
        renderExpenses();
    }

    function deleteExpense(originalIndex) {
        if(window.confirm('確定刪除這筆紀錄嗎？')) {
            expenses.splice(originalIndex, 1);
            localStorage.setItem('tripExpenses', JSON.stringify(expenses));
            renderExpenses();
        }
    }

    function clearExpenses() {
        // 使用 confirm() 因為這是不可逆操作，無法用自定義彈窗完全替代
        if(window.confirm('確定清空所有記帳資料？此操作無法復原。')) {
            expenses = [];
            localStorage.setItem('tripExpenses', JSON.stringify(expenses));
            renderExpenses();
        }
    }
    
    // --- 4. 景點備註與圖片邏輯 (新加入) ---
    // 儲存格式: { 'day1': [ {text: '...', images: []}, {...} ], 'day2': [...] }
    let spotNotes = JSON.parse(localStorage.getItem('spotNotes')) || {
        day1: [{}, {}, {}],
        day2: [{}, {}, {}, {}],
        day3: [{}, {}, {}],
        day4: [{}, {}, {}],
        day5: [{}, {}, {}],
    };

    // 初始化 spotNotes 結構，確保每個景點都有空物件
    function initializeSpotNotes() {
        const days = ['day1', 'day2', 'day3', 'day4', 'day5'];
        const spotsPerDay = { day1: 3, day2: 4, day3: 3, day4: 3, day5: 3 };
        
        days.forEach(dayId => {
            if (!spotNotes[dayId]) spotNotes[dayId] = [];
            while (spotNotes[dayId].length < spotsPerDay[dayId]) {
                spotNotes[dayId].push({ text: '', images: [] });
            }
        });
        localStorage.setItem('spotNotes', JSON.stringify(spotNotes));
    }

    // 儲存備註文字
    function saveSpotNote(dayId, spotIndex) {
        const textarea = document.querySelector(`#note-${dayId}-${spotIndex} textarea`);
        if (spotNotes[dayId] && spotNotes[dayId][spotIndex]) {
            spotNotes[dayId][spotIndex].text = textarea.value;
            localStorage.setItem('spotNotes', JSON.stringify(spotNotes));
        }
    }

    // 處理圖片上傳
    async function addSpotImage(dayId, spotIndex) {
        const imageInput = document.getElementById(`image-${dayId}-${spotIndex}`);
        const imageFile = imageInput.files[0];

        if (!imageFile) return;

        const maxSize = 500 * 1024; // 500 KB 限制
        if (imageFile.size > maxSize) {
            showCustomAlert('圖片檔案過大 (限制 500KB)，請選擇較小的圖片。');
            imageInput.value = ''; // 清除檔案輸入
            return;
        }

        try {
            const base64Image = await fileToBase64(imageFile);
            if (spotNotes[dayId] && spotNotes[dayId][spotIndex]) {
                // 如果 images 陣列不存在，則初始化
                if (!spotNotes[dayId][spotIndex].images) {
                    spotNotes[dayId][spotIndex].images = [];
                }
                spotNotes[dayId][spotIndex].images.push(base64Image);
                localStorage.setItem('spotNotes', JSON.stringify(spotNotes));
                renderSpotImages(dayId, spotIndex);
                imageInput.value = ''; // 清除檔案輸入
            }
        } catch(e) {
            showCustomAlert('讀取圖片失敗。');
            imageInput.value = '';
        }
    }

    // 渲染景點備註圖片列表
    function renderSpotImages(dayId, spotIndex) {
        const imagesContainer = document.getElementById(`images-${dayId}-${spotIndex}`);
        if (!imagesContainer || !spotNotes[dayId] || !spotNotes[dayId][spotIndex]) return;

        imagesContainer.innerHTML = '';
        const images = spotNotes[dayId][spotIndex].images || [];

        images.forEach((base64, imgIndex) => {
            const img = document.createElement('img');
            img.src = base64;
            img.className = 'w-16 h-16 object-cover rounded-md flex-shrink-0 cursor-pointer transition-transform hover:scale-105';
            img.onclick = () => showFullImage(base64, dayId, spotIndex, imgIndex); // 點擊縮圖顯示全螢幕
            imagesContainer.appendChild(img);
        });
    }

    // 載入備註和圖片
    function loadSpotNotes() {
        initializeSpotNotes(); // 確保結構完整

        const days = ['day1', 'day2', 'day3', 'day4', 'day5'];
        days.forEach(dayId => {
            if (spotNotes[dayId]) {
                spotNotes[dayId].forEach((note, index) => {
                    const textarea = document.querySelector(`#note-${dayId}-${index} textarea`);
                    if (textarea && note.text) {
                        textarea.value = note.text;
                    }
                    renderSpotImages(dayId, index);
                });
            }
        });
    }


    // 初始化
    document.getElementById('rate').value = currentRate;
    renderExpenses();
    convertCurrency();
    loadSpotNotes(); // 載入景點備註
</script>
</body>
</html>