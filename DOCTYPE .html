<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å—ä¹å·äº”æ—¥éŠåŠ©æ‰‹</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #e67e22;
            --bg: #f4f7f6;
            --card: #ffffff;
            --text: #333;
            --danger: #e74c3c;
            --success: #27ae60;
        }
        * { box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; -webkit-tap-highlight-color: transparent; }
        
        /* Header */
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 100; box-shadow: 0 2px 8px rgba(0,0,0,0.15); }
        h1 { margin: 0; font-size: 1.2rem; letter-spacing: 1px; }
        
        /* Navigation */
        nav { position: fixed; bottom: 0; width: 100%; background: white; display: flex; justify-content: space-around; padding: 10px 0; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); z-index: 100; padding-bottom: max(10px, env(safe-area-inset-bottom)); }
        nav button { background: none; border: none; font-size: 0.8rem; color: #95a5a6; cursor: pointer; display: flex; flex-direction: column; align-items: center; transition: color 0.2s; }
        nav button.active { color: var(--secondary); font-weight: bold; }
        nav button span { font-size: 1.4rem; margin-bottom: 4px; }

        /* Sections */
        .section { display: none; padding: 20px 15px; max-width: 600px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .section.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }

        /* Itinerary Cards */
        .day-card { background: var(--card); border-radius: 12px; padding: 15px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.02); border: 1px solid rgba(0,0,0,0.03); }
        .day-header { font-weight: 800; color: var(--primary); margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
        .day-header span { font-size: 0.9em; color: var(--secondary); background: rgba(230, 126, 34, 0.1); padding: 4px 8px; border-radius: 20px; }
        
        .spot { display: flex; align-items: center; margin: 12px 0; padding: 12px; background: #fff; border: 1px solid #eee; border-radius: 8px; cursor: pointer; transition: all 0.2s; position: relative; overflow: hidden; }
        .spot:active { background: #f5f5f5; transform: scale(0.98); }
        .spot::after { content: 'â”'; position: absolute; right: 15px; color: #ddd; font-size: 1.2em; }
        .spot-icon { margin-right: 15px; font-size: 1.4rem; width: 30px; text-align: center; }
        .spot-info { flex: 1; }
        .spot-name { font-weight: 600; font-size: 1rem; color: #444; }
        .hotel { margin-top: 15px; padding: 12px; background: #e8f6f3; border-radius: 8px; color: #16a085; font-size: 0.9rem; font-weight: 500; display: flex; align-items: center; gap: 8px; border: 1px solid #d1f2eb; cursor: pointer; }

        /* Expense Tracker */
        .total-banner { background: linear-gradient(135deg, #2c3e50, #34495e); color: white; padding: 20px; border-radius: 15px; margin-bottom: 25px; text-align: center; box-shadow: 0 4px 15px rgba(44, 62, 80, 0.3); }
        .total-price { font-size: 2.2rem; font-weight: bold; margin: 10px 0; }
        
        .tool-card { background: white; padding: 20px; border-radius: 12px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .tool-card h3 { margin-top: 0; color: var(--primary); font-size: 1.1rem; }

        .input-group { display: flex; gap: 10px; margin-bottom: 15px; }
        input, select { padding: 12px; border: 1px solid #ddd; border-radius: 8px; flex: 1; font-size: 1rem; -webkit-appearance: none; transition: border 0.2s; }
        input:focus { outline: none; border-color: var(--secondary); }
        
        button.btn-add { background: var(--secondary); color: white; border: none; padding: 12px; border-radius: 8px; font-weight: bold; font-size: 1rem; width: 100%; cursor: pointer; box-shadow: 0 2px 5px rgba(230, 126, 34, 0.3); transition: background 0.2s; }
        button.btn-add:active { transform: translateY(1px); box-shadow: none; }
        
        .expense-list { margin-top: 10px; }
        .expense-item { display: flex; justify-content: space-between; align-items: center; padding: 15px 0; border-bottom: 1px solid #f0f0f0; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { opacity: 0; transform: translateX(-10px); } to { opacity: 1; transform: translateX(0); } }
        
        .expense-meta { display: flex; flex-direction: column; gap: 4px; }
        .expense-desc { font-weight: 600; font-size: 1.05rem; }
        .expense-twd { font-size: 0.85rem; color: #7f8c8d; background: #eee; padding: 2px 6px; border-radius: 4px; display: inline-block; width: fit-content; }
        .expense-actions { display: flex; align-items: center; gap: 15px; }
        .expense-jpy { font-weight: bold; color: var(--primary); font-size: 1.1rem; }
        .delete-btn { color: #e74c3c; cursor: pointer; padding: 5px; font-size: 1.2rem; opacity: 0.7; }
        .delete-btn:hover { opacity: 1; }

        .empty-state { text-align: center; color: #bdc3c7; margin: 40px 0; }
        .empty-state div { font-size: 3rem; margin-bottom: 10px; }

        /* Tools */
        .weather-btn { display: flex; justify-content: space-between; align-items: center; width: 100%; padding: 15px; margin: 8px 0; background: #3498db; color: white; text-decoration: none; border-radius: 8px; font-weight: 500; transition: background 0.2s; }
        .weather-btn:active { background: #2980b9; }
        .rate-calc label { font-size: 0.9rem; color: #7f8c8d; }
    </style>
</head>
<body>

<header>
    <h1>ğŸ‡¯ğŸ‡µ å—ä¹å·äº”æ—¥éŠåŠ©æ‰‹</h1>
</header>

<!-- è¡Œç¨‹é é¢ -->
<div id="itinerary" class="section active">
    <div class="day-card">
        <div class="day-header">Day 1 <span>é¹¿å…’å³¶</span></div>
        <div onclick="openMap('æ¡ƒåœ’åœ‹éš›æ©Ÿå ´')" class="spot"><span class="spot-icon">âœˆï¸</span><div class="spot-info"><div class="spot-name">æ¡ƒåœ’åœ‹éš›æ©Ÿå ´</div></div></div>
        <div onclick="openMap('é¹¿å…’å³¶ç©ºæ¸¯')" class="spot"><span class="spot-icon">ğŸ›¬</span><div class="spot-info"><div class="spot-name">é¹¿å…’å³¶ç©ºæ¸¯</div></div></div>
        <div onclick="openMap('é¹¿å…’å³¶ç‡’é…’å’Œå•¤é…’ä¸»é¡Œæ¨‚åœ’')" class="spot"><span class="spot-icon">ğŸº</span><div class="spot-info"><div class="spot-name">é¹¿å…’å³¶ç‡’é…’å’Œå•¤é…’ä¸»é¡Œæ¨‚åœ’</div></div></div>
        <div onclick="openMap('çŸ¥è¦½æ­¦å®¶å±‹æ•·åº­åœ’')" class="spot"><span class="spot-icon">ğŸ¯</span><div class="spot-info"><div class="spot-name">çŸ¥è¦½æ­¦å®¶å±‹æ•·</div></div></div>
        <div onclick="openMap('å¤©æ–‡é¤¨å•†åº—è¡—')" class="spot"><span class="spot-icon">ğŸ›ï¸</span><div class="spot-info"><div class="spot-name">å¤©æ–‡é¤¨å•†åº—è¡—</div></div></div>
        <div onclick="openMap('SHIROYAMA HOTEL kagoshima')" class="hotel">ğŸ¨ ä½å®¿ï¼šåŸå±±è§€å…‰é£¯åº—</div>
    </div>

    <div class="day-card">
        <div class="day-header">Day 2 <span>æ«»å³¶/éœ§å³¶</span></div>
        <div onclick="openMap('åŸå±±å…¬åœ’å±•æœ›å°')" class="spot"><span class="spot-icon">ğŸ‘€</span><div class="spot-info"><div class="spot-name">åŸå±±å…¬åœ’å±•æœ›å°</div></div></div>
        <div onclick="openMap('ä»™å·–åœ’')" class="spot"><span class="spot-icon">ğŸŒ¸</span><div class="spot-info"><div class="spot-name">ä»™å·–åœ’</div></div></div>
        <div onclick="openMap('é¹¿å…’å³¶æ¸¯')" class="spot"><span class="spot-icon">ğŸš¢</span><div class="spot-info"><div class="spot-name">æ«»å³¶æ¸¡è¼ª (å¾€æ«»å³¶æ¸¯)</div></div></div>
        <div onclick="openMap('æœ‰æ‘ç†”å²©å±•æœ›æ‰€')" class="spot"><span class="spot-icon">ğŸŒ‹</span><div class="spot-info"><div class="spot-name">æœ‰æ‘ç†”å²©å±•æœ›æ‰€</div></div></div>
        <div onclick="openMap('éœ§å³¶ç¥å®®')" class="spot"><span class="spot-icon">â›©ï¸</span><div class="spot-info"><div class="spot-name">éœ§å³¶ç¥å®®</div></div></div>
        <div onclick="openMap('Kirishima Kokusai Hotel')" class="hotel">ğŸ¨ ä½å®¿ï¼šéœ§å³¶å›½éš›é£¯åº—</div>
    </div>

    <div class="day-card">
        <div class="day-header">Day 3 <span>å®®å´æ—¥å—</span></div>
        <div onclick="openMap('é—œä¹‹å°¾ç€‘å¸ƒ')" class="spot"><span class="spot-icon">ğŸŒŠ</span><div class="spot-info"><div class="spot-name">é—œä¹‹å°¾ç€‘å¸ƒ</div></div></div>
        <div onclick="openMap('AEON Mall Miyazaki')" class="spot"><span class="spot-icon">ğŸ›’</span><div class="spot-info"><div class="spot-name">AEON å¤¢æ¨‚åŸå®®å´</div></div></div>
        <div onclick="openMap('Sun Messe Nichinan')" class="spot"><span class="spot-icon">ğŸ—¿</span><div class="spot-info"><div class="spot-name">æ—¥å—å¤ªé™½èŠ±åœ’ (æ‘©è‰¾)</div></div></div>
        <div onclick="openMap('Udo Shrine')" class="spot"><span class="spot-icon">ğŸ‡</span><div class="spot-info"><div class="spot-name">éµœæˆ¶ç¥å®®</div></div></div>
        <div onclick="openMap('Miyazaki Kanko Hotel')" class="hotel">ğŸ¨ ä½å®¿ï¼šå®®å´è§€å…‰é£¯åº—</div>
    </div>

    <div class="day-card">
        <div class="day-header">Day 4 <span>é«˜åƒç©—</span></div>
        <div onclick="openMap('Obi Castle')" class="spot"><span class="spot-icon">ğŸ¯</span><div class="spot-info"><div class="spot-name">é£«è‚¥åŸè·¡</div></div></div>
        <div onclick="openMap('Amaterasu Railway')" class="spot"><span class="spot-icon">ğŸš‚</span><div class="spot-info"><div class="spot-name">é«˜åƒç©—å¤©ç…§éµé“</div></div></div>
        <div onclick="openMap('Takachiho Gorge')" class="spot"><span class="spot-icon">ğŸš£</span><div class="spot-info"><div class="spot-name">é«˜åƒç©—å³½/çœŸåäº•ç€‘å¸ƒ</div></div></div>
        <div onclick="openMap('Takachiho Shrine')" class="spot"><span class="spot-icon">ğŸŒ²</span><div class="spot-info"><div class="spot-name">é«˜åƒç©—ç¥ç¤¾</div></div></div>
        <div onclick="openMap('ANA Crowne Plaza Kumamoto New Sky')" class="hotel">ğŸ¨ ä½å®¿ï¼šANA ç†Šæœ¬æ–°å¤©ç©º</div>
    </div>

    <div class="day-card">
        <div class="day-header">Day 5 <span>ç†Šæœ¬/è¿”ç¨‹</span></div>
        <div onclick="openMap('Kumamoto Castle')" class="spot"><span class="spot-icon">ğŸ¯</span><div class="spot-info"><div class="spot-name">ç†Šæœ¬åŸ</div></div></div>
        <div onclick="openMap('SAKURA MACHI Kumamoto')" class="spot"><span class="spot-icon">ğŸ›ï¸</span><div class="spot-info"><div class="spot-name">æ«»ç”ºè³¼ç‰©ä¸­å¿ƒ</div></div></div>
        <div onclick="openMap('Suizenji Jojuen Garden')" class="spot"><span class="spot-icon">ğŸµ</span><div class="spot-info"><div class="spot-name">æ°´å‰å¯ºæˆè¶£åœ’</div></div></div>
        <div onclick="openMap('Aso Kumamoto Airport')" class="spot"><span class="spot-icon">ğŸ›«</span><div class="spot-info"><div class="spot-name">ç†Šæœ¬ç©ºæ¸¯ -> æ¡ƒåœ’</div></div></div>
    </div>
</div>

<!-- è¨˜å¸³é é¢ -->
<div id="expenses" class="section">
    <div class="total-banner">
        <div style="opacity:0.9; margin-bottom:5px;">ç¸½æ”¯å‡º (ç´„åˆå°å¹£)</div>
        <div class="total-price" id="totalTWD">NT$ 0</div>
        <div style="font-size:0.9rem; opacity:0.8; background:rgba(255,255,255,0.2); padding:2px 10px; border-radius:10px; display:inline-block;">
            ç¸½æ—¥å¹£: <span id="totalJPY">Â¥0</span>
        </div>
    </div>

    <div class="tool-card">
        <h3>âœï¸ æ–°å¢æ¶ˆè²»</h3>
        <div class="input-group">
            <input type="text" id="descInput" placeholder="é …ç›® (å¦‚: æ‹‰éºµ)">
            <input type="number" id="amtInput" inputmode="decimal" placeholder="æ—¥å¹£é‡‘é¡" onkeypress="handleKeyPress(event)">
        </div>
        <button class="btn-add" onclick="addExpense()">+ è¨˜ä¸€ç­†</button>
    </div>

    <div id="expenseList" class="expense-list">
        <!-- JS renders items here -->
    </div>

    <div style="text-align:center; margin-top:30px; margin-bottom: 20px;">
        <button onclick="clearExpenses()" style="color:#999; background:none; border:1px solid #ddd; padding:8px 15px; border-radius:20px; font-size:0.85rem;">ğŸ—‘ï¸ æ¸…ç©ºæ‰€æœ‰ç´€éŒ„</button>
    </div>
</div>

<!-- å·¥å…·é é¢ -->
<div id="tools" class="section">
    <div class="tool-card">
        <h3>ğŸŒ¤ï¸ åŠæ™‚å¤©æ°£é å ±</h3>
        <a href="https://tenki.jp/forecast/9/46/8810/" target="_blank" class="weather-btn">
            <span>é¹¿å…’å³¶ Kagoshima</span> <span>â”</span>
        </a>
        <a href="https://tenki.jp/forecast/9/45/8710/" target="_blank" class="weather-btn">
            <span>å®®å´ Miyazaki</span> <span>â”</span>
        </a>
        <a href="https://tenki.jp/forecast/9/43/8610/" target="_blank" class="weather-btn">
            <span>ç†Šæœ¬ Kumamoto</span> <span>â”</span>
        </a>
    </div>

    <div class="tool-card">
        <h3>ğŸ’° åŒ¯ç‡è¨­å®š (JPY â†’ TWD)</h3>
        <p style="font-size:0.85rem; color:#666; margin-bottom:15px;">è¨­å®šåŒ¯ç‡å¾Œæœƒè‡ªå‹•å„²å­˜ï¼Œè¨˜å¸³ç¸½é¡ä¹Ÿæœƒéš¨ä¹‹æ›´æ–°ã€‚</p>
        <div class="rate-calc">
            <div style="display:flex; align-items:center; gap:10px; margin-bottom:10px;">
                <label>ç›®å‰åŒ¯ç‡:</label>
                <input type="number" id="rate" step="0.001" inputmode="decimal" style="width:100px; font-weight:bold; color:var(--secondary);" onchange="updateRate()" onkeyup="updateRate()">
            </div>
            <div style="height:1px; background:#eee; margin:15px 0;"></div>
            <label>å¿«é€Ÿè©¦ç®—:</label>
            <div class="input-group">
                <input type="number" id="calcJpy" placeholder="è¼¸å…¥æ—¥å¹£" inputmode="decimal" oninput="convertCurrency()">
                <div style="display:flex; align-items:center; font-weight:bold; min-width: 100px;">
                    = NT$ <span id="calcTwd" style="margin-left:5px; color:var(--secondary);">0</span>
                </div>
            </div>
        </div>
    </div>
</div>

<nav>
    <button onclick="switchTab('itinerary', this)" class="active"><span>ğŸ“…</span>è¡Œç¨‹</button>
    <button onclick="switchTab('expenses', this)"><span>ğŸ’¸</span>è¨˜å¸³</button>
    <button onclick="switchTab('tools', this)"><span>ğŸ§°</span>å·¥å…·</button>
</nav>

<script>
    // --- 1. Navigation Logic ---
    function switchTab(tabId, btn) {
        document.querySelectorAll('.section').forEach(el => el.classList.remove('active'));
        document.getElementById(tabId).classList.add('active');
        document.querySelectorAll('nav button').forEach(el => el.classList.remove('active'));
        btn.classList.add('active');
        window.scrollTo(0,0);
    }

    // --- 2. Map Logic ---
    function openMap(locationName) {
        // ä½¿ç”¨æ›´ç²¾ç¢ºçš„æœå°‹å­—ä¸²ï¼Œé¿å…è·³è½‰éŒ¯èª¤
        const query = encodeURIComponent(locationName);
        window.open(`https://www.google.com/maps/search/?api=1&query=${query}`, '_blank');
    }

    // --- 3. Expense Logic ---
    // å¾ localStorage è®€å–åŒ¯ç‡ï¼Œè‹¥ç„¡å‰‡é è¨­ 0.215
    let currentRate = parseFloat(localStorage.getItem('tripRate')) || 0.215;
    let expenses = JSON.parse(localStorage.getItem('tripExpenses')) || [];

    // [Fix] å®šç¾©æ ¼å¼åŒ–å·¥å…· (å°‡é€™äº›ç§»åˆ°åˆå§‹åŒ–é‚è¼¯ä¹‹å‰)
    const formatJPY = (num) => new Intl.NumberFormat('ja-JP', { style: 'currency', currency: 'JPY', maximumFractionDigits: 0 }).format(num);
    const formatTWD = (num) => new Intl.NumberFormat('zh-TW', { style: 'currency', currency: 'TWD', maximumFractionDigits: 0 }).format(num);

    // åˆå§‹åŒ–
    document.getElementById('rate').value = currentRate;
    renderExpenses();

    function renderExpenses() {
        const list = document.getElementById('expenseList');
        const totalTwdEl = document.getElementById('totalTWD');
        const totalJpyEl = document.getElementById('totalJPY');
        
        list.innerHTML = '';
        
        if (expenses.length === 0) {
            list.innerHTML = `
                <div class="empty-state">
                    <div>ğŸƒ</div>
                    <p>ç›®å‰æ²’æœ‰è¨˜å¸³è³‡æ–™</p>
                </div>
            `;
            totalJpyEl.innerText = formatJPY(0);
            totalTwdEl.innerText = formatTWD(0);
            return;
        }

        let totalJpy = 0;

        // è¤‡è£½ä¸€ä»½é™£åˆ—ä¸¦åè½‰ï¼Œè®“æœ€æ–°çš„é¡¯ç¤ºåœ¨ä¸Šé¢
        expenses.slice().reverse().forEach((item) => {
            const amount = parseFloat(item.amount);
            totalJpy += amount;
            const twdVal = Math.round(amount * currentRate);
            
            const div = document.createElement('div');
            div.className = 'expense-item';
            div.innerHTML = `
                <div class="expense-meta">
                    <div class="expense-desc">${item.desc}</div>
                    <div class="expense-twd">ç´„ ${formatTWD(twdVal)}</div>
                </div>
                <div class="expense-actions">
                    <span class="expense-jpy">${formatJPY(amount)}</span>
                    <span class="delete-btn" onclick="deleteExpense(${item.id})">Ã—</span>
                </div>
            `;
            list.appendChild(div);
        });

        totalJpyEl.innerText = formatJPY(totalJpy);
        totalTwdEl.innerText = formatTWD(Math.round(totalJpy * currentRate));
    }

    function addExpense() {
        const descInput = document.getElementById('descInput');
        const amtInput = document.getElementById('amtInput');
        
        const desc = descInput.value.trim();
        const amt = parseFloat(amtInput.value);
        
        if(desc && !isNaN(amt) && amt > 0) {
            // ä½¿ç”¨ Date.now() ç”¢ç”Ÿå”¯ä¸€ IDï¼Œé¿å…åˆªé™¤æ™‚éŒ¯èª¤
            const newItem = {
                id: Date.now(),
                desc: desc,
                amount: amt
            };
            expenses.push(newItem);
            saveData();
            
            // æ¸…ç©ºè¼¸å…¥ä¸¦èšç„¦å›ç¬¬ä¸€å€‹æ¬„ä½ï¼Œæ–¹ä¾¿é€£çºŒè¼¸å…¥
            descInput.value = '';
            amtInput.value = '';
            descInput.focus(); 
            renderExpenses();
        } else {
            // ç°¡å–®çš„æ–æ™ƒå‹•ç•«æˆ–æç¤º
            alert('è«‹è¼¸å…¥æœ‰æ•ˆçš„é …ç›®åç¨±å’Œé‡‘é¡');
        }
    }

    // æ”¯æ´æŒ‰ Enter éµé€å‡º
    function handleKeyPress(e) {
        if(e.key === 'Enter') addExpense();
    }

    // é€é ID åˆªé™¤ï¼Œæ¯” Index æ›´å®‰å…¨
    function deleteExpense(id) {
        if(confirm('ç¢ºå®šåˆªé™¤é€™ç­†ç´€éŒ„å—ï¼Ÿ')) {
            expenses = expenses.filter(item => item.id !== id);
            saveData();
            renderExpenses();
        }
    }

    function clearExpenses() {
        if(expenses.length === 0) return;
        if(confirm('ç¢ºå®šæ¸…ç©ºæ‰€æœ‰è¨˜å¸³è³‡æ–™ï¼Ÿæ­¤å‹•ä½œç„¡æ³•å¾©åŸã€‚')) {
            expenses = [];
            saveData();
            renderExpenses();
        }
    }

    function saveData() {
        localStorage.setItem('tripExpenses', JSON.stringify(expenses));
    }

    // --- 4. Tool Logic ---
    function updateRate() {
        const rateInput = document.getElementById('rate').value;
        const newRate = parseFloat(rateInput);
        if(!isNaN(newRate) && newRate > 0) {
            currentRate = newRate;
            localStorage.setItem('tripRate', currentRate); // å„²å­˜åŒ¯ç‡è¨­å®š
            renderExpenses(); // é‡æ–°è¨ˆç®—ç¸½é¡
            convertCurrency(); // è‹¥ä¸‹æ–¹è©¦ç®—æœ‰æ•¸å€¼ï¼Œä¹Ÿä¸€èµ·æ›´æ–°
        }
    }

    function convertCurrency() {
        const jpy = parseFloat(document.getElementById('calcJpy').value);
        
        if(!isNaN(jpy)) {
            document.getElementById('calcTwd').innerText = Math.round(jpy * currentRate).toLocaleString();
        } else {
            document.getElementById('calcTwd').innerText = '0';
        }
    }
</script>

</body>
</html>